--JUN 2023

CREATE TABLE SEKTOR(
    ID NUMBER PRIMARY KEY,
    NAZIV VARCHAR(30),
    LOKACIJA VARCHAR(30) CHECK LOKACIJA IN ("Nis", "Novi Sad", "Kragujevac")
);

CREATE TABLE ZAPOSLENI(
    ID NUMBER PRIMARY KEY,
    IME VARCHAR(30),
    PREZIME VARCHAR(30),
    TELEFON VARCHAR(10),
    ADRESA VARCHAR(100),
    GOD_RODJENJA DATE,
    STRUCNA_SPREMA VARCHAR(20) NOT NULL
);

CREATE TABLE POZICIJA(
    ZAPOSLENI_ID NUMBER REFERENCES ZAPOSLENI(ID),
    SEKTOR_ID NUMBER REFERENCES SEKTOR(ID),
    DATUM_POC DATE,
    DATUM_KRAJA DATE DEFAULT NULL,
    NAZIV VARHCAR(30),
    PLATA NUMBER,
    CONSTRAINT POZICIJA_PK PRIMARY KEY (ZAPOSLENI_ID, SEKTOR_ID, DATUM_POC)
);

SELECT POZICIJA.NAZIV, AVG(PLATA) AS PROSECNA_PLATA, SUM(DATUM_POC - DATUM_KRAJA) AS BROJ_RADNIH_DANA
FROM POZICIJA
WHERE DATUM_KRAJA IS NOT NULL
GROUP BY POZICIJA.NAZIV; ?????????????????????????????????


SELECT ZAPOSLENI.IME, ZAPOSLENI.PREZIME
FROM SEKTOR, ZAPOSLENI, POZICIJA
WHERE SEKTOR.ID = POZICIJA.SEKTOR_ID AND POZICIJA.ZAPOSLENI_ID = ZAPOSLENI.ID AND DATUM_KRAJA IS NULL
AND SEKTOR.ID IN (SELECT ID FROM (SELECT SEKTOR.ID, COUNT(*)
FROM SEKTOR, ZAPOSLENI, POZICIJA
WHERE SEKTOR.ID = POZICIJA.SEKTOR_ID AND POZICIJA.ZAPOSLENI_ID = ZAPOSLENI.ID AND DATUM_KRAJA IS NULL
GROUP BY SEKTOR.ID
HAVING COUNT(*) > 10))
MINUS
SELECT ZAPOSLENI.IME, ZAPOSLENI.PREZIME
FROM SEKTOR, ZAPOSLENI, POZICIJA
WHERE SEKTOR.ID = POZICIJA.SEKTOR_ID AND POZICIJA.ZAPOSLENI_ID = ZAPOSLENI.ID AND DATUM_KRAJA IS NOT NULL
AND SEKTOR.ID IN(SELECT ID FROM (SELECT SEKTOR.ID, COUNT(*)
FROM SEKTOR, ZAPOSLENI, POZICIJA
WHERE SEKTOR.ID = POZICIJA.SEKTOR_ID AND POZICIJA.ZAPOSLENI_ID = ZAPOSLENI.ID AND DATUM_KRAJA IS NOT NULL
GROUP BY SEKTOR.ID
HAVING COUNT(*) > 3))

SELECT POZICIJA.NAZIV, COUNT(*)
FROM POZICIJA, SEKTOR
WHERE SEKTOR.ID = POZICIJA.SEKTOR_ID AND SEKTOR.LOKACIJA = 'Nis' AND DATUM_KRAJA IS NOT NULL
GROUP BY POZICIJA.NAZIV
HAVING COUNT(*) = (SELECT MAX(COUNT(*))
FROM POZICIJA, SEKTOR
WHERE SEKTOR.ID = POZICIJA.SEKTOR_ID AND SEKTOR.LOKACIJA = 'Nis' AND DATUM_KRAJA IS NOT NULL
GROUP BY POZICIJA.NAZIV)